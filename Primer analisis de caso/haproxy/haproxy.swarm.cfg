global
    log stdout format raw local0
    maxconn 4096
    tune.ssl.default-dh-param 2048

defaults
    log     global
    mode    http
    option  httplog
    option  dontlognull
    timeout connect 5s
    timeout client  30s
    timeout server  30s

frontend http
    bind *:80
    http-request redirect scheme https unless { ssl_fc }

frontend https
    bind *:443 ssl crt /certs/selfsigned.pem
    
    stick-table type ip size 100k expire 10m store http_req_rate(10s)
    http-request track-sc0 src
    http-request deny if { sc_http_req_rate(0) gt 100 }

    default_backend app_backend

backend app_backend
    balance roundrobin
    option httpchk GET /health
    http-check expect status 200
    server app app:8080 check
